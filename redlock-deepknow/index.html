<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"isdaniel.github.io","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å‰è¨€æˆ‘ä¹‹å‰æœ‰å¯«é€é lock or CAS ä¾†é˜²æ²»ï¼ŒRacing condition å•é¡Œï¼Œä½†å¦‚æœé€™å€‹å•é¡Œå»¶æ·±åˆ°å¤šå°æœå‹™å™¨ç”šè‡³æ˜¯ micor-services æ¶æ§‹æˆ‘å€‘è¦æ€éº¼è™•ç†è³‡æ–™å•é¡Œå‘¢? ä¸‹é¢ç¨‹å¼åœ¨å–®é«”æœå‹™æˆ–æ‡‰ç”¨ç¨‹å¼ä¸æœƒå‡ºå•é¡Œï¼Œä½†å¦‚æœæœå‹™å™¨æœ‰å¤šå°å•é¡Œå¯å°±å¤§äº†ï¼Œå› ç‚ºä¸‹é¢çš„ lock åªé™æ–¼å–®é«” Server ä¸Š 1234567891011121314151617181920private rea">
<meta property="og:type" content="article">
<meta property="og:title" content="åˆ©ç”¨Redlockæ¼”ç®—æ³•å¯¦ç¾è‡ªå·±çš„åˆ†ä½ˆå¼é–">
<meta property="og:url" content="https://isdaniel.github.io/redlock-deepknow/index.html">
<meta property="og:site_name" content="çŸ³é ­çš„codingä¹‹è·¯">
<meta property="og:description" content="å‰è¨€æˆ‘ä¹‹å‰æœ‰å¯«é€é lock or CAS ä¾†é˜²æ²»ï¼ŒRacing condition å•é¡Œï¼Œä½†å¦‚æœé€™å€‹å•é¡Œå»¶æ·±åˆ°å¤šå°æœå‹™å™¨ç”šè‡³æ˜¯ micor-services æ¶æ§‹æˆ‘å€‘è¦æ€éº¼è™•ç†è³‡æ–™å•é¡Œå‘¢? ä¸‹é¢ç¨‹å¼åœ¨å–®é«”æœå‹™æˆ–æ‡‰ç”¨ç¨‹å¼ä¸æœƒå‡ºå•é¡Œï¼Œä½†å¦‚æœæœå‹™å™¨æœ‰å¤šå°å•é¡Œå¯å°±å¤§äº†ï¼Œå› ç‚ºä¸‹é¢çš„ lock åªé™æ–¼å–®é«” Server ä¸Š 1234567891011121314151617181920private rea">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/nt8Q9Sv.png">
<meta property="og:image" content="https://i.imgur.com/7Zyji6N.png">
<meta property="og:image" content="https://i.imgur.com/nqxIxwD.png">
<meta property="og:image" content="https://i.imgur.com/SGdamvC.png">
<meta property="og:image" content="https://i.imgur.com/3w0cD8l.png">
<meta property="article:published_time" content="2021-10-25T09:30:11.000Z">
<meta property="article:modified_time" content="2025-12-01T14:15:33.370Z">
<meta property="article:author" content="Daniel Shih">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="Redlock">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/nt8Q9Sv.png">

<link rel="canonical" href="https://isdaniel.github.io/redlock-deepknow/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>åˆ©ç”¨Redlockæ¼”ç®—æ³•å¯¦ç¾è‡ªå·±çš„åˆ†ä½ˆå¼é– | çŸ³é ­çš„codingä¹‹è·¯</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9964202165342528"
     crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKF58CMZ8X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-ZKF58CMZ8X');
  </script>
  <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
  </script>
  <meta name="google-adsense-account" content="ca-pub-9964202165342528">

  <style>
    /* Full-screen overlay */
    #adblock-overlay {
      display: none;
      position: fixed;
      z-index: 9999;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.85);
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding-top: 20%;
    }

    #adblock-overlay h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }

    #adblock-overlay p {
      font-size: 1.2em;
    }
  </style>
  <script>
    /*document.addEventListener("DOMContentLoaded", function () {
      const overlay = document.getElementById("adblock-overlay");

      const adScript = document.createElement("script");
      adScript.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9964202165342528";
      adScript.async = true;
      adScript.crossOrigin = "anonymous";

      adScript.onerror = function () {
        console.warn("Adblock detected â€” showing full-page overlay.");
        overlay.style.display = "block";
        document.body.style.overflow = "hidden"; // prevent scroll
      };

      document.head.appendChild(adScript);
    });*/
  </script>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  
  <div id="adblock-overlay">
    <h1>ğŸš« Ad Blocker Detected</h1>
    <p>Please disable your AD blocker to continue using this site. Ads help us keep the content free! please press keyboard F5 to refresh page after disabled AD blocker</p>
    <p>è«‹é—œé–‰å»£å‘Šæ””æˆªå™¨ä»¥ç¹¼çºŒä½¿ç”¨æœ¬ç¶²ç«™ã€‚å»£å‘Šæœ‰åŠ©æ–¼æˆ‘å€‘ä¿è­‰å…§å®¹å…è²»ã€‚è¬è¬! é—œé–‰å¾Œè«‹æŒ‰ F5 åˆ·æ–°é é¢</p>
  </div>
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">çŸ³é ­çš„codingä¹‹è·¯</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Hello World</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-course">

    <a href="/Course/" rel="section"><i class="fa fa-fw fa-book"></i>Course</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">141</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">70</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">189</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://isdaniel.github.io/redlock-deepknow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9159452?s=460&v=4">
      <meta itemprop="name" content="Daniel Shih">
      <meta itemprop="description" content="å¥½é»å­æ²’åƒ¹å€¼ï¼Œæœ‰åƒ¹å€¼çš„æ˜¯æŠŠå¥½é»å­å¯¦ç¾">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="çŸ³é ­çš„codingä¹‹è·¯">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          åˆ©ç”¨Redlockæ¼”ç®—æ³•å¯¦ç¾è‡ªå·±çš„åˆ†ä½ˆå¼é–
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-25 09:30:11" itemprop="dateCreated datePublished" datetime="2021-10-25T09:30:11+00:00">2021-10-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-01 14:15:33" itemprop="dateModified" datetime="2025-12-01T14:15:33+00:00">2025-12-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/redlock-deepknow/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="redlock-deepknow/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä¹‹å‰æœ‰å¯«é€é <a href="https://isdaniel.github.io/high-concurrency-atomic-cas-algorithm/">lock or CAS</a> ä¾†é˜²æ²»ï¼ŒRacing condition å•é¡Œï¼Œä½†å¦‚æœé€™å€‹å•é¡Œå»¶æ·±åˆ°å¤šå°æœå‹™å™¨ç”šè‡³æ˜¯ micor-services æ¶æ§‹æˆ‘å€‘è¦æ€éº¼è™•ç†è³‡æ–™å•é¡Œå‘¢?</p>
<p>ä¸‹é¢ç¨‹å¼åœ¨å–®é«”æœå‹™æˆ–æ‡‰ç”¨ç¨‹å¼ä¸æœƒå‡ºå•é¡Œï¼Œä½†å¦‚æœæœå‹™å™¨æœ‰å¤šå°å•é¡Œå¯å°±å¤§äº†ï¼Œå› ç‚ºä¸‹é¢çš„ lock åªé™æ–¼å–®é«” Server ä¸Š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">static</span> <span class="built_in">object</span> _lock = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">[<span class="meta">HttpGet()</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Get</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> remainCount;</span><br><span class="line">    <span class="keyword">lock</span> (_lock)</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        remainCount = (<span class="built_in">int</span>)RedisConnection.GetDatabase().StringGet(_productId);</span><br><span class="line">        <span class="keyword">if</span> (remainCount &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            RedisConnection.GetDatabase().StringSet(_productId, --remainCount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> productMsg = remainCount &lt;= <span class="number">0</span> ? <span class="string">&quot;æ²’è²¨äº†è³£å®Œäº†&quot;</span> : <span class="string">$&quot;é‚„å‰©ä¸‹ <span class="subst">&#123;remainCount&#125;</span> å•†å“&quot;</span>;</span><br><span class="line">    <span class="built_in">string</span> result = <span class="string">$&quot;<span class="subst">&#123;Dns.GetHostName()&#125;</span> è™•ç†è²¨ç‰©ç‹€æ…‹!! <span class="subst">&#123;productMsg&#125;</span>&quot;</span>;</span><br><span class="line">    _logger.LogInformation(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰è½é Redis å¯èƒ½å°±æœƒè½é <a href="https://github.com/samcook/RedLock.net">RedLock.net</a> ä¾†è™•ç†ï¼Œä½†æ‚¨çŸ¥é“ RedLock.net åº•å±¤å¤§è‡´ä¸Šæ€éº¼å¯¦ä½œçš„å—?</p>
<p>æœ¬ç¯‡æ–‡ç« æœƒå¸¶é ˜å¤§å®¶é€é distlock ç®—æ³•æ™‚åšå‡ºï¼Œè‡ªå·±çš„Redlock</p>
<blockquote>
<p>æœ¬ç¯‡åªä»‹ç´¹æ ¸å¿ƒæ¦‚å¿µï¼Œç´°éƒ¨é˜²éŒ¯æˆ‘æ²’æœ‰å¯«å‡ºä¾†ï¼Œæ‰€ä»¥å»ºè­°æœ¬ç¯‡ç¨‹å¼ä¸è¦ç”¨åœ¨ prod ç’°å¢ƒ</p>
</blockquote>
<p>æˆ‘ä½¿ç”¨ docker-compose å»ºç«‹å•é¡Œæ¶æ§‹ï¼Œæ¶æ§‹åœ–å¦‚ä¸‹</p>
<p><img src="https://i.imgur.com/nt8Q9Sv.png"></p>
<p>åŸå§‹ç¢¼ä½ç½® <a href="https://github.com/isdaniel/Redlock-Csharp">Redlock-Csharp</a></p>
<h2 id="How-to-Run"><a href="#How-to-Run" class="headerlink" title="How to Run"></a>How to Run</h2><p>åœ¨æ ¹ç›®éŒ„ä½¿ç”¨ <code>docker-compose up -d</code> è·‘èµ·ä¾†å¾Œæ‡‰è©²æœƒæœ‰ä¸‹é¢äº”å€‹çµ„ä»¶</p>
<p><img src="https://i.imgur.com/7Zyji6N.png"></p>
<p>å¾Œé¢æˆ‘å€‘é€²å…¥ Redis Server åˆ©ç”¨å‘½ä»¤å»ºç«‹ä¸€å€‹å•†å“å’Œæ•¸é‡ <code>set pid:1 1000</code></p>
<blockquote>
<p><code>pid=1</code> æœ‰ 1000 å€‹</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it b489eb20ab74 bash</span><br><span class="line">root@b489eb20ab74:/data# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> pid:1 1000</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>åœ¨æŸ¥è©¢ <code>http://localhost:8080/WebStore</code> å¯ä»¥ç²å¾—ä¸‹åœ–ä»£è¡¨çµ„ä»¶å»ºç«‹å®Œç•¢</p>
<p><img src="https://i.imgur.com/nqxIxwD.png"></p>
<h2 id="Redlock-æ¼”ç®—æ³•"><a href="#Redlock-æ¼”ç®—æ³•" class="headerlink" title="Redlock æ¼”ç®—æ³•"></a>Redlock æ¼”ç®—æ³•</h2><p>å…¶å¯¦ <a href="https://redis.io/topics/distlock">distlock</a> ç®—æ³•èªªæ˜åœ¨ Redis å®˜ç¶²æœ‰ä¸€ç¯‡å°ˆé–€ä¾†èªªæ˜ï¼Œ</p>
<p>æ¸¬è©¦æª”æ¡ˆå·²ç¶“æº–å‚™å¥½äº† <code>/test/shopping.jmx</code>ï¼Œæˆ‘å€‘ä½¿ç”¨ jmeter ä¾†å£“æ¸¬ï¼Œä½¿ç”¨å£“åŠ›æ¸¬è©¦ç¨‹å¼ï¼Œå»ºè­° Jmeter ä½¿ç”¨ Thread æœ€å¥½å°æ–¼æˆ–ç­‰æ–¼ cpu core count (æœ€å¥½è¨­å®š2çš„å€æ•¸)</p>
<p>ex: æˆ‘çš„é›»è…¦ 8 core æˆ‘å¯ä»¥è¨­å®š 8 thread concurrent</p>
<p>é€™é‚Šæœ‰ä¸€å€‹æƒ…å¢ƒå‡è¨­ï¼Œæœ‰ä¸€å€‹å•†å“ç§’æ®ºåªæœ‰ 200 å€‹å•†å“</p>
<p>é€™é‚Šæˆ‘å€‘è¦æ€éº¼é˜²æ­¢è³£è¶…å‘¢?</p>
<p>æˆ‘å€‘æŠŠ <code>lock</code> éƒ¨åˆ†æ›¿æ›æˆæˆ‘å€‘è‡ªå·±å¯«çš„ <code>RedLock</code> ç‰©ä»¶ï¼æˆ‘æœ‰é€é Redis ç®—æ³•å¯¦ç¾ä¸€å€‹ç°¡å–®çš„åˆ†ä½ˆå¼é–</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpGet()</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Get</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    RedLock redlock = <span class="keyword">new</span> RedLock(RedisConnection);</span><br><span class="line">    <span class="built_in">int</span> remainCount;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        redlock.LockInstance(<span class="string">&quot;redkey&quot;</span>, <span class="keyword">new</span> TimeSpan(<span class="number">00</span>, <span class="number">00</span>, <span class="number">10</span>), <span class="keyword">out</span> <span class="keyword">var</span> lockObject);</span><br><span class="line">        remainCount = (<span class="built_in">int</span>)RedisConnection.GetDatabase().StringGet(_productId);</span><br><span class="line">        <span class="keyword">if</span> (remainCount &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            RedisConnection.GetDatabase().StringSet(_productId, --remainCount);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        redlock.UnlockInstance(<span class="string">&quot;redkey&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">string</span> productMsg = remainCount &lt;= <span class="number">0</span> ? <span class="string">&quot;æ²’è²¨äº†è³£å®Œäº†&quot;</span> : <span class="string">$&quot;é‚„å‰©ä¸‹ <span class="subst">&#123;remainCount&#125;</span> å•†å“&quot;</span>;</span><br><span class="line">    <span class="built_in">string</span> result = <span class="string">$&quot;<span class="subst">&#123;Dns.GetHostName()&#125;</span> è™•ç†è²¨ç‰©ç‹€æ…‹!! <span class="subst">&#123;productMsg&#125;</span>&quot;</span>;</span><br><span class="line">    _logger.LogInformation(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€é jmeter å£“åŠ›æ¸¬è©¦</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ .\jmeter -n -t .\shopping.jmx -l .\shopping.jtl</span><br><span class="line">Creating summariser &lt;summary&gt;</span><br><span class="line">Starting standalone </span><br><span class="line">Waiting <span class="keyword">for</span> possible Shutdown/StopTestNow/HeapDump/ThreadDump message on port 4445</span><br><span class="line">summary +      1 <span class="keyword">in</span> 00:00:01 =    1.0/s Avg:    91 Min:    91 Max:    91 Err:     0 (0.00%) Active: 15 Started: 15 Finished: 0</span><br><span class="line">summary +   1599 <span class="keyword">in</span> 00:00:12 =  137.1/s Avg:    77 Min:     3 Max:  8921 Err:     0 (0.00%) Active: 0 Started: 16 Finished: 16</span><br><span class="line">summary =   1600 <span class="keyword">in</span> 00:00:13 =  126.8/s Avg:    77 Min:     3 Max:  8921 Err:     0 (0.00%)</span><br><span class="line">Tidying up ...    @ Mon Oct 25 11:37:15 CST 2021 (1635133035562)</span><br><span class="line">... end of run</span><br></pre></td></tr></table></figure>

<p>çµæœå¦‚ä¸‹ï¼š</p>
<p>åœ¨å¤šå° server ä¸Šä¸¦æ²’æœ‰å‡ºç¾è³£è¶…</p>
<p><img src="https://i.imgur.com/SGdamvC.png"></p>
<h3 id="RedLock-è§£èªªç¨‹å¼"><a href="#RedLock-è§£èªªç¨‹å¼" class="headerlink" title="RedLock è§£èªªç¨‹å¼"></a>RedLock è§£èªªç¨‹å¼</h3><p>è£¡é¢æœ€æ ¸å¿ƒç¨‹å¼æ˜¯ <code>RedLock</code> é¡åˆ¥ï¼å»ºæ§‹å­æœƒå‚³å…¥æˆ‘å€‘ä½¿ç”¨ <code>Redis</code> Connection</p>
<p>å…¶ä¸­æ ¸å¿ƒæ–¹å¼æ˜¯</p>
<ul>
<li>LockInstance</li>
<li>UnlockInstance</li>
</ul>
<h4 id="LockInstance"><a href="#LockInstance" class="headerlink" title="LockInstance"></a>LockInstance</h4><p>åœ¨ Lock éœ€è¦æ³¨æ„ Atomic ä¸¦ä¸”éœ€è¦çµ¦ä¸€å€‹ TTL ä¸ç„¶å‡å¦‚æ©Ÿå™¨çªç„¶ç•¶æ©Ÿæˆ–è·³é›»ï¼Œæœƒé€ æˆé–ä¸æœƒè§£æ”¾å…¶ä»–äººæœƒç„¡é™æœŸ blocking</p>
<p>ä¸‹é¢é€™æ®µè©±æ˜¯ä¾†æ˜¯å®˜ç¶²</p>
<blockquote>
<p>since this is actually a viable solution in applications where a race condition from time to time is acceptable, and because locking into a single instance is the foundation weâ€™ll use for the distributed algorithm described here.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET resource_name my_random_value NX PX 30000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NX â€“ Only set the key if it does not already exist.</p>
</blockquote>
<p>Redis æ“ä½œå‘½ä»¤æ˜¯ä¸€å€‹ single Thread åŸ·è¡Œæ‰€ä»¥å‘½ä»¤å¦‚æœå¯ä»¥åŒ…åœ¨ä¸€åŒ…æˆ–ä¸€æ¢ä¾†åŸ·è¡Œå°±å¯ä»¥ä¿è­‰ Atomicï¼Œ<a href="https://redis.io/commands/set">SET</a> <code>NX</code> å‘½ä»¤<strong>ä¸å­˜åœ¨</strong> key å»ºç«‹æ•¸å€¼ (å…·æœ‰ Atomic )</p>
<p>å¦å¤–æˆ‘ç‚ºäº†é¿å…ä¸€ç›´åœ¨ç©ºè½‰ï¼Œæˆ‘æœƒåˆ¤æ–·å‡å¦‚ç›®å‰æœ‰äººä½”æœ‰é–æˆ‘æœƒè‡ªæ—‹ç­‰å¾…ä¸€å€‹æ™‚é–“( lock TTL )ï¼Œåˆ°äº†å¾Œåœ¨å˜—è©¦è¨ªå•ï¼ˆå¯ä»¥æœ‰æ›´å„ªçš„ç®—æ³•ä½†æˆ‘æ‡¶å¾—å¯«äº†ï¼‰é¿å…æµªè²»è³‡æºç©ºè½‰</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RedLock</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IConnectionMultiplexer _connection;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _keyId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedLock</span>(<span class="params">IConnectionMultiplexer connection</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _connection = connection;</span><br><span class="line">        _keyId = <span class="string">$&quot;<span class="subst">&#123;Guid.NewGuid().ToString()&#125;</span>-Tid:<span class="subst">&#123;Thread.CurrentThread.ManagedThreadId&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">LockInstance</span>(<span class="params"><span class="built_in">string</span> resource, TimeSpan ttl, <span class="keyword">out</span> LockObject lockObject</span>)</span></span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="built_in">bool</span> result;</span><br><span class="line">        lockObject = <span class="keyword">new</span> LockObject(resource, _keyId, ttl);</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">            result = _connection.GetDatabase().StringSet(resource, _keyId, ttl, When.NotExists);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(!result)</span><br><span class="line">                    WaitForLock(resource);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">while</span> (!result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception)</span><br><span class="line">        &#123;</span><br><span class="line">            result = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">WaitForLock</span>(<span class="params"><span class="built_in">string</span> resource</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> waitTime = _connection.GetDatabase().KeyTimeToLive(resource);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(waitTime.HasValue)&#123;</span><br><span class="line">            SpinWait.SpinUntil(()=&gt;<span class="literal">true</span>,waitTime.Value.Milliseconds);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="UnlockInstance"><a href="#UnlockInstance" class="headerlink" title="UnlockInstance"></a>UnlockInstance</h4><p>æˆ‘å€‘å¿…é ˆè®“ <strong>æŸ¥è©¢</strong> è·Ÿ <strong>åˆªé™¤</strong> keyid æœ‰ Atomic æ‰€ä»¥æœ‰å…©ç¨®åšæ³•</p>
<ol>
<li>é€é Lua è…³æœ¬è®“å‘½ä»¤é€£çºŒ</li>
<li>ä½¿ç”¨ Redis transaction æ¨¡å¼</li>
</ol>
<p>æœ¬æ¬¡ç¨‹å¼è§£é–ç¨‹å¼æ˜¯é  Lua è…³æœ¬ä¾†å®Œæˆ( Redis å®˜ç¶²æ¨è–¦)</p>
<p>ä¸‹é¢æ˜¯å®˜ç¶²çš„èªªæ˜</p>
<blockquote>
<p>This is important in order to avoid removing a lock that was created by another client. For example a client may acquire the lock, get blocked in some operation for longer than the lock validity time (the time at which the key will expire), and later remove the lock, that was already acquired by some other client. Using just DEL is not safe as a client may remove the lock of another client. With the above script instead every lock is â€œsignedâ€ with a random string, so the lock will be removed only if it is still the one that was set by the client trying to remove it.</p>
</blockquote>
<p>å»ºè­°åœ¨ Keyid é‚£é‚Šå¯ä»¥æ¨™ç¤ºæ˜¯ç”±ä½ ç”¢ç”Ÿçš„é–é¿å…åˆªé™¤åˆ°åˆ¥äºº lockï¼Œæ‰€ä»¥æˆ‘çš„ç¨‹å¼ keyid ä½¿ç”¨ GUID + ThreadId ä¾†ä¿è­‰ä¸æœƒæœ‰äººè·Ÿæˆ‘ç”¢ç”Ÿä¸€æ¨£çš„ keyId</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RedLock</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IConnectionMultiplexer _connection;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _keyId;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> UNLOCK_SCRIPT = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">        if redis.call(&quot;&quot;get&quot;&quot;,KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">            return redis.call(&quot;&quot;del&quot;&quot;,KEYS[1])</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        end&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedLock</span>(<span class="params">IConnectionMultiplexer connection</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _connection = connection;</span><br><span class="line">        _keyId = <span class="string">$&quot;<span class="subst">&#123;Guid.NewGuid().ToString()&#125;</span>-Tid:<span class="subst">&#123;Thread.CurrentThread.ManagedThreadId&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnlockInstance</span>(<span class="params"><span class="built_in">string</span> resource</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RedisKey[] keys = &#123; resource &#125;;</span><br><span class="line">        RedisValue[] values = &#123; _keyId &#125;;</span><br><span class="line">        _connection.GetDatabase().ScriptEvaluate(</span><br><span class="line">            UNLOCK_SCRIPT,</span><br><span class="line">            keys,</span><br><span class="line">            values</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/3w0cD8l.png"></p>
<h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>æœ¬æ¬¡è·Ÿå¤§å®¶ä»‹ç´¹ Redlock ç®—æ³•å¸¶è‘—å¤§å®¶å¿«é€Ÿèµ°éä¸€éï¼Œèƒ½ç™¼ç¾å¯¦ç¾ lock ç®—æ³•å…¶å¯¦ä¸æœƒå¾ˆé›£ï¼Œé€™é‚Šç•™ä¸€å€‹åœ°æ–¹è®“å¤§å®¶è€ƒæ…®ä¸€ä¸‹</p>
<p>ä¹‹å‰æˆ‘æœ‰ç¯‡æ–‡ç« è¨è«– <a href="https://isdaniel.github.io/lock-deepknow/">c# lock</a> åŸç†ï¼Œè£¡é¢æœ‰è¨è«–å¯é‡å…¥é–æ¨¡å¼ï¼Œå‡å¦‚çµ¦ä½ å¯¦ç¾å¯é‡å…¥é–ä½ æœƒå¯¦ç¾å—ï¼Ÿ</p>
<p>åœ¨å¯¦ç¾çš„éç¨‹ä¸­ä½ æœƒç™¼ç¾åŸä¾† lock æ ¸å¿ƒæ˜¯ç®—æ³•è€Œä¸æ˜¯å¯¦ä½œï¼Œå¯¦ä½œå¯ä»¥ç”±è¨±å¤šæ–¹å¼ä¾†è™•ç†ä½†ç®—æ³•æ¦‚å¿µä¸æœƒè®Š</p>
<p>æœ¬ç¨‹å¼ä¸å»ºè­°åœ¨ Prod ä¸Šä½¿ç”¨ï¼Œå› ç‚ºæˆ‘æ²’æœ‰å¯¦ç¾å¤šå° master Redis åŒæ­¥ lockã€é– TTL åˆ°äº† logic é‚„åœ¨åŸ·è¡Œéœ€è¦å»¶é•·ç­‰ç­‰å•é¡Œâ€¦</p>
<p><strong>æ­¤æ–‡ä½œè€…</strong>ï¼šDaniel Shih(çŸ³é ­)<br /><strong>æ­¤æ–‡åœ°å€</strong>ï¼š <a href="https://isdaniel.github.io/redlock-deepknow/">https://isdaniel.github.io/redlock-deepknow/</a> <br /><strong>ç‰ˆæ¬Šè²æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥è²æ˜å¤–ï¼Œå‡æ¡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/tw/">CC BY-NC-SA 3.0 TW</a> è¨±å¯å”è­°ã€‚è½‰è¼‰è«‹è¨»æ˜å‡ºè™•ï¼</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/ACID/" rel="bookmark">ACID</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/AOP-Lock-Mechanism/" rel="bookmark">AOP Lock Architecture</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/AutoMapperInit/" rel="bookmark">(AutoMapper)åå°„è‡ªå‹•è¨»å†ŠAutoMapper Profile</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Autofac-AOP/" rel="bookmark">Autofac + Interceptors(AOP) å‹•æ…‹ä»£ç†</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Autofac-introduce/" rel="bookmark">Autofac (IOC)å®¹å™¨ä»‹ç´¹</a></div>
    </li>
  </ul>
<div style="text-align: center;">
    å¦‚æœæœ¬æ–‡å°æ‚¨å¹«åŠ©å¾ˆå¤§ï¼Œå¯<a href="https://www.jkos.com/">è¡—å£æ”¯ä»˜</a>æ–—å…§é¼“å‹µçŸ³é ­^^
</div>

<img src="https://i.imgur.com/1D2UpQk.png">


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C#</a>
              <a href="/tags/Redis/" rel="tag"># Redis</a>
              <a href="/tags/Redlock/" rel="tag"># Redlock</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/postgresql-cost-factor-tuning/" rel="prev" title="postgresql åŸ·è¡Œè¨ˆç•«é‡è¦å› å­ (æˆæœ¬å› å­èª¿æ•™)">
      <i class="fa fa-chevron-left"></i> postgresql åŸ·è¡Œè¨ˆç•«é‡è¦å› å­ (æˆæœ¬å› å­èª¿æ•™)
    </a></div>
      <div class="post-nav-item">
    <a href="/map-theory/" rel="next" title="è³‡æ–™åº«æŸ¥è©¢æ ¸å¿ƒæ¦‚å¿µ-åœ°åœ–ç†è«–">
      è³‡æ–™åº«æŸ¥è©¢æ ¸å¿ƒæ¦‚å¿µ-åœ°åœ–ç†è«– <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-Run"><span class="nav-number">2.</span> <span class="nav-text">How to Run</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redlock-%E6%BC%94%E7%AE%97%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">Redlock æ¼”ç®—æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RedLock-%E8%A7%A3%E8%AA%AA%E7%A8%8B%E5%BC%8F"><span class="nav-number">3.1.</span> <span class="nav-text">RedLock è§£èªªç¨‹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LockInstance"><span class="nav-number">3.1.1.</span> <span class="nav-text">LockInstance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UnlockInstance"><span class="nav-number">3.1.2.</span> <span class="nav-text">UnlockInstance</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%B5%90"><span class="nav-number">4.</span> <span class="nav-text">å°çµ</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Daniel Shih"
      src="https://avatars0.githubusercontent.com/u/9159452?s=460&v=4">
  <p class="site-author-name" itemprop="name">Daniel Shih</p>
  <div class="site-description" itemprop="description">å¥½é»å­æ²’åƒ¹å€¼ï¼Œæœ‰åƒ¹å€¼çš„æ˜¯æŠŠå¥½é»å­å¯¦ç¾</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">189</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">70</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">141</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/isdaniel" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;isdaniel" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dog8300228@gmail.com" title="Email â†’ mailto:dog8300228@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/profile.php?id=100001400319136" title="FaceBook â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100001400319136" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>FaceBook</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/5176071/d-shih" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;5176071&#x2F;d-shih" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
      </span>
  </div>



<p><a href="https://stackoverflow.com/users/5176071/d-shih"><img alt="profile for D-Shih at Stack Overflow, Q&amp;A for professional and enthusiast programmers" height="58" src="https://stackoverflow.com/users/flair/5176071.png?theme=dark" title="profile for D-Shih at Stack Overflow, Q&amp;A for professional and enthusiast programmers" width="208" /> </a></p>

<div>
<a href="https://info.flagcounter.com/tORe"><img src="https://s01.flagcounter.com/count/tORe/bg_F1FF29/txt_000000/border_9DCCC4/columns_2/maxflags_10/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
</div>

Certificationsï¼š

<div data-iframe-width="150" data-iframe-height="270" data-share-badge-id="41c9e6a3-2a37-49e1-9a53-37e0bfa9e6e1" data-share-badge-host="https://www.credly.com"></div><script type="text/javascript" async src="//cdn.credly.com/assets/utilities/embed.js"></script>

<amp-auto-ads type="adsense"
        data-ad-client="ca-pub-9964202165342528">
</amp-auto-ads>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daniel Shih</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">924k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">14:01</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v8.1.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri == 'https://isdaniel.github.io/redlock-deepknow/',]
      });
      });
  </script>

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://danielshih.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://isdaniel.github.io/redlock-deepknow/";
    this.page.identifier = "redlock-deepknow/";
    this.page.title = "åˆ©ç”¨Redlockæ¼”ç®—æ³•å¯¦ç¾è‡ªå·±çš„åˆ†ä½ˆå¼é–";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://danielshih.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
